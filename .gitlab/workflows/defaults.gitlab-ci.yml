# Default GitLab CI settings and workflow rules for Python Documentation Init

workflow:
  rules:
    # Run on merge requests
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    # Run on main/master branch commits
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
    # Run on tags
    - if: $CI_COMMIT_TAG
    # Run on web/API triggers
    - if: $CI_PIPELINE_SOURCE == "web"
    - if: $CI_PIPELINE_SOURCE == "api"

# Default settings for all jobs
default:
  # Retry failed jobs automatically
  retry:
    max: 2
    when:
      - runner_system_failure
      - stuck_or_timeout_failure
      - scheduler_failure

  # Use uv cache to speed up builds
  cache:
    key:
      files:
        - pyproject.toml
        - uv.lock
    paths:
      - .venv/

# Global variables
variables:
  # Python version for CI (can be overridden per job)
  PYTHON_VERSION: "3.11"

  # uv configuration
  UV_CACHE_DIR: "${CI_PROJECT_DIR}/.uv-cache"
  UV_LINK_MODE: "copy"

  # Git configuration
  GIT_DEPTH: "0"  # Full clone for version tagging
  GIT_STRATEGY: clone

  # Pipeline configuration
  FF_USE_FASTZIP: "true"
  ARTIFACT_COMPRESSION_LEVEL: "fast"
  CACHE_COMPRESSION_LEVEL: "fast"
